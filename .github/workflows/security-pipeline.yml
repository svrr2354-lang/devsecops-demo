name: DevSecOps Pipeline

# Trigger this pipeline whenever code is pushed to the 'main' branch
on:
  push:
    branches: [ main ]

jobs:
  build-and-hack:
    runs-on: ubuntu-latest  # This is the cloud server GitHub gives us

    steps:
    # 1. Check out your code onto the server
    - name: Checkout Code
      uses: actions/checkout@v3

    # 2. Build the Docker image (just like you did on your laptop)
    - name: Build Docker Image
      run: docker build -t vulnerable-bank .

    # 3. Run the container in the background
    - name: Run Docker Container
      run: docker run -d -p 5000:5000 vulnerable-bank

    # 4. Wait a few seconds for the app to start
    - name: Wait for App to Start
      run: sleep 5

    # 5. Install Python tools for the attacker script
    - name: Install Test Dependencies
      run: pip install requests

    # 6. Run the Attack!
    - name: Run Automated Security Test
      run: python exploit.py